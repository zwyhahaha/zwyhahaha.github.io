<!DOCTYPE html>
<html lang="en">
    <head>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
        <script type="text/x-mathjax-config">
            MathJax.Hub.Config({
                tex2jax: {
                skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
                inlineMath: [['$','$']]
                }
            });
        </script>
    </head>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="google-site-verification" content="xBT4GhYoi5qRD5tr338pgPM5OWHHIDR6mNg1a3euekI" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="keywords"  content="Blog">
    <meta name="theme-color" content="#000000">
    
    <title>Generating Lyapunov Functions for Gradient Descent by SDP - Wanyu Zhang</title>

    <!-- Web App Manifest -->
    <link rel="manifest" href="/pwa/manifest.json">

    <!-- Favicon -->
    <link rel="shortcut icon" href="/img/favicon.ico">

    <!-- Safari Webpage Icon    by-BY -->
    <link rel="apple-touch-icon" href="/img/apple-touch-icon.png">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="http://localhost:4001/2025/09/06/AutoLyap/">

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="/css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/hux-blog.css">

    <!-- Pygments Github CSS -->
    <link rel="stylesheet" href="/css/syntax.css">

    <!-- Custom Fonts -->
    <!-- <link href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet" type="text/css"> -->
    <!-- Hux change font-awesome CDN to qiniu -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">


    <!-- Hux Delete, sad but pending in China
    <link href='http://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/
    css'>
    -->


    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- ga & ba script hoook -->
    <script></script>
</head>


<!-- hack iOS CSS :active style -->
<body ontouchstart="">

    <!-- Navigation -->
<nav class="navbar navbar-default navbar-custom navbar-fixed-top">
    <div class="container-fluid">
        <!-- Brand and toggle get grouped for better mobile display -->
        <div class="navbar-header page-scroll">
            <button type="button" class="navbar-toggle">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Over the Rainbow</a>
        </div>

        <!-- Collect the nav links, forms, and other content for toggling -->
        <div id="huxblog_navbar">
            <div class="navbar-collapse">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="/">Blogs</a>
                    </li>
                    
                    <li>
                        <a href="/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="/tags/">Tags</a>
                    </li>
                    
                    <li>
                        <a href="/travel/">Travel</a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <!-- /.navbar-collapse -->
    </div>
    <!-- /.container -->
</nav>
<script>
    // Drop Bootstarp low-performance Navbar
    // Use customize navbar with high-quality material design animation
    // in high-perf jank-free CSS3 implementation
    var $body   = document.body;
    var $toggle = document.querySelector('.navbar-toggle');
    var $navbar = document.querySelector('#huxblog_navbar');
    var $collapse = document.querySelector('.navbar-collapse');

    var __HuxNav__ = {
        close: function(){
            $navbar.className = " ";
            // wait until animation end.
            setTimeout(function(){
                // prevent frequently toggle
                if($navbar.className.indexOf('in') < 0) {
                    $collapse.style.height = "0px"
                }
            },400)
        },
        open: function(){
            $collapse.style.height = "auto"
            $navbar.className += " in";
        }
    }

    // Bind Event
    $toggle.addEventListener('click', function(e){
        if ($navbar.className.indexOf('in') > 0) {
            __HuxNav__.close()
        }else{
            __HuxNav__.open()
        }
    })

    /**
     * Since Fastclick is used to delegate 'touchstart' globally
     * to hack 300ms delay in iOS by performing a fake 'click',
     * Using 'e.stopPropagation' to stop 'touchstart' event from 
     * $toggle/$collapse will break global delegation.
     * 
     * Instead, we use a 'e.target' filter to prevent handler
     * added to document close HuxNav.  
     *
     * Also, we use 'click' instead of 'touchstart' as compromise
     */
    document.addEventListener('click', function(e){
        if(e.target == $toggle) return;
        if(e.target.className == 'icon-bar') return;
        __HuxNav__.close();
    })
</script>


    <script>
  window.MathJax = {
    tex: {
      inlineMath: [['\\(', '\\)'], ['$', '$']],
      displayMath: [['\\[', '\\]'], ['$$', '$$']],
      processEscapes: true,
      tags: 'ams',
      packages: {'[+]': ['bm']}
    },
    options: {
      skipHtmlTags: ['script','noscript','style','textarea','pre','code']
    }
  };
</script>
<script id="MathJax-script" async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js">
</script>

<!-- Post Content -->
<article>
    <div class="container">
        <div class="row">

    <!-- Post Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                post-container">

                <div class="post-meta-header">
                    <div class="post-tags">
                        
                        <a href="/tags/#Optimization" title="Optimization">Optimization</a>
                        
                    </div>
                    <h1>Generating Lyapunov Functions for Gradient Descent by SDP</h1>
                    
                    <span class="meta">Posted by Wanyu Zhang on September 6, 2025</span>
                </div>

				<p>This blog is the reading note of the following paper:</p>

<blockquote>
  <p>[1] Taylor, Adrien, Bryan Van Scoy, and Laurent Lessard. ‘‘Lyapunov functions for first-order methods: Tight automated convergence guarantees.” International Conference on Machine Learning. PMLR, 2018.</p>
</blockquote>

<h2 id="background">Background</h2>

<p>A key technique for proving the convergence of optimization algorithms is the  use of a Lyapunov function (also called a potential function). Such a function is designed to decrease (or contract) at every iteration, thereby establishing the algorithm’s convergence rate. However, constructing a suitable Lyapunov function is often nontrivial and typically requires expertise.</p>

<p><strong>Main idea of the paper.</strong> Paper [1] is among the earliest works on <em>automated</em> Lyapunov function construction. It studies first-order methods (FOMs), including gradient descent, the heavy-ball method, and Nesterov’s accelerated gradient method, for minimizing $L$-smooth and $\mu$-strongly convex functions. The authors propose a semidefinite programming (SDP) formulation that automatically generates Lyapunov functions and provides linear convergence guarantees.</p>

<p><strong>Scope of this blog.</strong>  The paper presents the SDP formulation directly followed by proof of its equivalence to finding a valid Lyapunov function. However, I found the derivation of the SDP formulation somewhat non-intuitive. To better understand it, I attempted to reconstruct the derivation in the simplest setting: gradient descent.</p>

\[x_1 = x_0 - \alpha \nabla f (x_0)\]

<p><strong>About potential functions.</strong> The potential function is defined on the state of the algorithm,</p>

\[\xi_k = (\mathbf{x}_k, \mathbf{g}_k, \mathbf{f}_k) := (x_k - x_{\star},
   \nabla f (x_k), f (x_k) - f (x_{\star})),\]

<p>and $\xi_{\star} = (0, 0, 0)$. The paper considers quadratic potential functions of the form</p>

\[\mathcal{V} (\xi_k) = \left[ \begin{array}{l}
     \mathbf{x}_k\\
     \mathbf{g}_k
   \end{array} \right]^{\top} (P \otimes I_d) \left[ \begin{array}{l}
     \mathbf{x}_k\\
     \mathbf{g}_k
   \end{array} \right] + q \mathbf{f}_k,\]

<p>where $P \in \mathbb{S}^2, p \in \mathbb{R}$ are the coefficients to be determined, and $I_d$ denotes the $d \times d$ identity matrix. To prove linear convergence for gradient descent with rate $0 \leq \rho &lt; 1$, the potential function must satisfy:</p>

<p>(1) $\mathcal{V} (\xi) \geq 0$ for all $\xi$,</p>

<p>(2) $\mathcal{V} (\xi) = 0$ if and only if $\xi = \xi_{\star}$,</p>

<p>(3) $\mathcal{V} (\xi) \rightarrow \infty$ as $| \xi | \rightarrow \infty$,</p>

<p>(4)  $\mathcal{V} (\xi_{k + 1}) \leq \rho^2  \mathcal{V} (\xi_k)$ for all $k$.</p>

<p>Under these conditions, linear convergence follows:</p>

\[\| x_k - x_{\star} \| = \mathcal{O} (\rho^k), \quad \| \nabla f (x_k) \| =
   \mathcal{O} (\rho^k), \quad f (x_k) - f_{\star} = \mathcal{O} (\rho^{2 k})
   .\]

<h2 id="given-rate-rho-find-the-potential-functions">Given rate $\rho$, find the potential functions</h2>

<p>The problem is to find a feasible $\mathcal{V} (\xi)$. Formally,</p>

\[\text{find }P, p, \quad \text{subject to conditions (1)-(4) being satisfied}\]

<h3 id="translating-condition-4">Translating condition (4)</h3>

<p>Condition (4) requires,</p>

\[\left[ \begin{array}{l}
     \mathbf{x}_1\\
     \mathbf{g}_1
   \end{array} \right]^{\top} (P \otimes I_d) \left[ \begin{array}{l}
     \mathbf{x}_1\\
     \mathbf{g}_1
   \end{array} \right] + q \mathbf{f}_1 \leq \rho^2 \left[ \begin{array}{l}
     \mathbf{x}_0\\
     \mathbf{g}_0
   \end{array} \right]^{\top} (P \otimes I_d) \left[ \begin{array}{l}
     \mathbf{x}_0\\
     \mathbf{g}_0
   \end{array} \right] + \rho^2 q \mathbf{f}_0.\]

<p>Since the left- and right-hand sides are defined over different variables, we rewrite the inequality by introducing the stacked vector</p>

\[\mathbf{b} =
\begin{bmatrix}
\mathbf{x}_0 \\
\mathbf{g}_0 \\
\mathbf{g}_1 \\
f_0 \\
f_1
\end{bmatrix}.\]

<p>With appropriate selector matrices, we can write</p>

\[\begin{aligned}
\begin{bmatrix}\mathbf{x}_1 \\ \mathbf{g}_1 \end{bmatrix}
&amp;= \Bigl( \begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix} \otimes I_d \Bigr)\mathbf{b}, 
&amp;\quad f_1 &amp;= I^f_1 \mathbf{b}, \\
\begin{bmatrix}\mathbf{x}_0 \\ \mathbf{g}_0 \end{bmatrix}
&amp;= \Bigl( \begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix} \otimes I_d \Bigr)\mathbf{b}, 
&amp;\quad f_0 &amp;= I^f_0 \mathbf{b}.
\end{aligned}\]

<p>Therefore, condition (4) is equivalent to</p>

\[\mathbf{b}^{\top}
\Biggl(
\Bigl(
\rho^2 
\begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}^{\top} 
P 
\begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}
-
\begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}^{\top} 
P 
\begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}
\Bigr)\otimes I_d
\Biggr)\mathbf{b}
+ (\rho^2 q I^f_0 - q I^f_1)\mathbf{b}
\geq 0.
\tag{C4}\]

<p><strong>Using interpolation conditions.</strong>  Inequality (C4) is difficult to verify directly. However, it becomes tractable once we use the interpolation properties of the function class. So far, we have not exploited the fact that the points $(x_0,g_0,f_0)$ and $(x_1,g_1,f_1)$ must lie on the same $L$-smooth, $\mu$-strongly convex function.</p>

<p>From interpolation theory, the following are equivalent:</p>

<ul>
  <li>
    <p>There exists $f \in \mathcal{F}_{\mu,L}$ such that</p>

\[g_k = \nabla f(x_k), \quad f_k = f(x_k), \quad \forall k \in \{0,1\};\]
  </li>
  <li>
    <p>For all $i,j \in {0,1,\star}$, the quadratic inequalities hold:</p>

\[\phi_{ij} := (L-\mu)(f_i - f_j)
+
\begin{bmatrix}
x_i \\ x_j \\ g_i \\ g_j
\end{bmatrix}^{\top}
(M^1 \otimes I_d)
\begin{bmatrix}
x_i \\ x_j \\ g_i \\ g_j
\end{bmatrix}
\geq 0,
\tag{I}\]

    <p>where $M^1 \in \mathbb{S}^4$ is a fixed symmetric matrix depending only on $L,\mu$.</p>
  </li>
</ul>

<p>(I) can be expressed in terms of $\mathbf{b}$ as</p>

\[\mathbf{b}^{\top}
\Bigl(
\underbrace{
\begin{bmatrix} I^x_i \\ I^x_j \\ I^g_i \\ I^g_j \end{bmatrix}^{\top}
M^1
\begin{bmatrix} I^x_i \\ I^x_j \\ I^g_i \\ I^g_j \end{bmatrix}
}_{M^1_{ij}}
\otimes I_d
\Bigr)\mathbf{b}
+
\underbrace{(L-\mu)(I^f_i - I^f_j)}_{m_{ij}}\mathbf{b} \geq 0.\]

<p><strong>The SDP formulation.</strong> Paper [1] shows that inequality (C) holds if and only if there exist nonnegative multipliers $\eta_{ij} \geq 0$ such that</p>

\[\begin{aligned}
\sum_{i,j \in \mathcal{I}} \eta_{ij} M^1_{ij}
&amp;\;\preceq\;
\rho^2
\begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}^{\top} P \begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}
-
\begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}^{\top} P \begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}, 
\\
\sum_{i,j \in \mathcal{I}} \eta_{ij} m_{ij}
&amp;\;\leq\;
\rho^2 q I^f_0 - q I^f_1.
\end{aligned} \tag{SDP-1}\]

<h3 id="translating-condition-1">Translating condition (1)</h3>

<p>Condition (1) requires</p>

\[\begin{bmatrix}
\mathbf{x}_0 \\
\mathbf{g}_0
\end{bmatrix}^{\top}
(P \otimes I_d)
\begin{bmatrix}
\mathbf{x}_0 \\
\mathbf{g}_0
\end{bmatrix}
+ q f_0 \;\;\geq\; 0,
\quad \forall\, \mathbf{x}_0, \mathbf{g}_0, f_0.
\tag{C1}\]

<p>Using interpolation between $(x_0, g_0, f_0)$ and the reference point $(x_{\star}, g_{\star}, f_{\star}) = (0,0,0)$, we have</p>

\[\phi := (L-\mu)\, f_0 
+ 
\begin{bmatrix}
\mathbf{x}_0 \\
\mathbf{g}_0
\end{bmatrix}^{\top}
(M^0 \otimes I_d)
\begin{bmatrix}
\mathbf{x}_0 \\
\mathbf{g}_0
\end{bmatrix}
\;\;\geq 0,\]

<p>where $M^0 \in \mathbb{S}^2$ is a fixed symmetric matrix depending only on $L,\mu$.</p>

<p>Therefore, inequality (C1) holds if there exists $\lambda \geq 0$ such that</p>

\[\begin{aligned}
\lambda M^0 &amp;\;\preceq\; P,  \\
\lambda (L-\mu) &amp;\;\leq\; q. 
\end{aligned}\tag{SDP-2}\]

<p>Conditions (2) and (3) are automatically ensured when (SDP-1) and (SDP-2) hold.</p>

<h3 id="the-complete-sdp-formulation">The complete SDP formulation</h3>

<p>Putting everything together: given contraction ratio $\rho$, the SDP problem to find a quadratic potential function is</p>

<p><strong>($\rho$-SDP)</strong>: Find $P \in \mathbb{S}^2$, $q \in \mathbb{R}$, multipliers $\eta_{ij} \geq 0$ for $i,j \in {0,1,\star}$, and $\lambda \geq 0$ such that</p>

\[\begin{aligned}
0 &amp;\;\preceq\; 
\rho^2 
\begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}^{\top} 
P 
\begin{bmatrix} I^x_0 \\ I^g_0 \end{bmatrix}
-
\begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}^{\top} 
P 
\begin{bmatrix} I^x_1 \\ I^g_1 \end{bmatrix}
- \sum_{i,j \in \mathcal{I}} \eta_{ij} M^1_{ij}, \\
0 &amp;\;\leq\; (\rho^2 q I^f_0 - q I^f_1) - \sum_{i,j \in \mathcal{I}} \eta_{ij} m_{ij}, \\
0 &amp;\;\preceq\; P - \lambda M^0, \\
0 &amp;\;\leq\; q - \lambda (L-\mu).
\end{aligned}\]

<p>Paper [1] proves that a quadratic potential function with contraction rate $\rho$ exists if and only if this SDP is feasible.</p>

<h2 id="find-rho">Find $\rho$</h2>

<p>Given $\rho$, we solve <strong>($\rho$-SDP)</strong>:</p>

<ul>
  <li>If the problem is feasible, the algorithm admits a Lyapunov function with contraction rate at most $\rho$.</li>
  <li>If the problem is infeasible, the algorithm cannot contract at rate $\rho$.</li>
</ul>

<p>To obtain the tightest convergence guarantee, we perform a bisection search on the interval $[0,1]$. Starting from the midpoint, we test feasibility:</p>
<ul>
  <li>if feasible, we continue the search on the left subinterval;</li>
  <li>if infeasible, we continue on the right subinterval.</li>
</ul>

<p>The procedure terminates when we identify the smallest $\rho$ for which <strong>($\rho$-SDP)</strong> is feasible.</p>



                <hr style="visibility: hidden;">

                <ul class="pager">
                    
                    <li class="previous">
                        <a href="/2025/08/01/HangZhou/" data-toggle="tooltip" data-placement="top" title="Hangzhou, Yichang, and Xi'an">
                        Previous<br>
                        <span>Hangzhou, Yichang, and Xi'an</span>
                        </a>
                    </li>
                    
                    
                    <li class="next">
                        <a href="/2025/12/25/vegas/" data-toggle="tooltip" data-placement="top" title="Canyons & Colors of the Southwest">
                        Next<br>
                        <span>Canyons & Colors of the Southwest</span>
                        </a>
                    </li>
                    
                </ul>


                <!--Gitalk评论start  -->
                
                <!-- Gitalk end -->

                

            </div>  

    <!-- Side Catalog Container -->
        
            <div class="
                col-lg-2 col-lg-offset-0
                visible-lg-block
                sidebar-container
                catalog-container">
                <div class="side-catalog">
                    <hr class="hidden-sm hidden-xs">
                    <h5>
                        <a class="catalog-toggle" href="#">CATALOG</a>
                    </h5>
                    <ul class="catalog-body"></ul>
                </div>
            </div>
        

    <!-- Sidebar Container -->
            <div class="
                col-lg-8 col-lg-offset-2
                col-md-10 col-md-offset-1
                sidebar-container">

                <!-- Featured Tags -->
                
                <section>
                    <hr class="hidden-sm hidden-xs">
                    <h5><a href="/tags/">FEATURED TAGS</a></h5>
                    <div class="tags">
        				
                            
                				<a href="/tags/#Optimization" title="Optimization" rel="11">
                                    Optimization
                                </a>
                            
        				
                            
                				<a href="/tags/#Tips" title="Tips" rel="7">
                                    Tips
                                </a>
                            
        				
                            
                				<a href="/tags/#Travel✈️" title="Travel✈️" rel="4">
                                    Travel✈️
                                </a>
                            
        				
        			</div>
                </section>
                

                <!-- Friends Blog -->
                
            </div>
        </div>
    </div>
</article>






<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>
<!-- anchor-js, Doc:http://bryanbraun.github.io/anchorjs/ -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/anchor-js/1.1.1/anchor.min.js",function(){
        // BY Fix:去除标题前的‘#’ issues:<https://github.com/qiubaiying/qiubaiying.github.io/issues/137>
        // anchors.options = {
        //   visible: 'always',
        //   placement: 'right',
        //   icon: '#'
        // };
        anchors.add().remove('.post-meta-header h1').remove('.subheading').remove('.sidebar-container h5');
    })
</script>
<style>
    /* place left on bigger screen */
    @media all and (min-width: 800px) {
        .anchorjs-link{
            position: absolute;
            left: -0.75em;
            font-size: 1.1em;
            margin-top : -0.1em;
        }
    }
</style>



    <!-- jQuery -->
<script src="/js/jquery.min.js "></script>

<!-- Bootstrap Core JavaScript -->
<script src="/js/bootstrap.min.js "></script>

<!-- Custom Theme JavaScript -->
<script src="/js/hux-blog.js "></script>

<!-- Service Worker -->

<script type="text/javascript">
    if(navigator.serviceWorker){
        // For security reasons, a service worker can only control the pages that are in the same directory level or below it. That's why we put sw.js at ROOT level.
        navigator.serviceWorker
            .register('/sw.js')
            .then((registration) => {console.log('Service Worker Registered. ', registration)})
            .catch((error) => {console.log('ServiceWorker registration failed: ', error)})
    }
</script>



<!-- async load function -->
<script>
    function async(u, c) {
      var d = document, t = 'script',
          o = d.createElement(t),
          s = d.getElementsByTagName(t)[0];
      o.src = u;
      if (c) { o.addEventListener('load', function (e) { c(null, e); }, false); }
      s.parentNode.insertBefore(o, s);
    }
</script>

<!-- 
     Because of the native support for backtick-style fenced code blocks 
     right within the Markdown is landed in Github Pages, 
     From V1.6, There is no need for Highlight.js, 
     so Huxblog drops it officially.

     - https://github.com/blog/2100-github-pages-now-faster-and-simpler-with-jekyll-3-0  
     - https://help.github.com/articles/creating-and-highlighting-code-blocks/ 
     - https://github.com/jneen/rouge/wiki/list-of-supported-languages-and-lexers   
-->
<!--
    <script>
        async("http://cdn.bootcss.com/highlight.js/8.6/highlight.min.js", function(){
            hljs.initHighlightingOnLoad();
        })
    </script>
    <link href="http://cdn.bootcss.com/highlight.js/8.6/styles/github.min.css" rel="stylesheet">
-->


<!-- jquery.tagcloud.js -->
<script>
    // only load tagcloud.js in tag.html
    if($('#tag_cloud').length !== 0){
        async('/js/jquery.tagcloud.js',function(){
            $.fn.tagcloud.defaults = {
                //size: {start: 1, end: 1, unit: 'em'},
                color: {start: '#bbbbee', end: '#0085a1'},
            };
            $('#tag_cloud a').tagcloud();
        })
    }
</script>

<!--fastClick.js -->
<script>
    async("//cdnjs.cloudflare.com/ajax/libs/fastclick/1.0.6/fastclick.min.js", function(){
        var $nav = document.querySelector("nav");
        if($nav) FastClick.attach($nav);
    })
</script>


<!-- Google Analytics -->



<!-- Baidu Tongji -->




<!-- Side Catalog -->

<script type="text/javascript">
    function generateCatalog (selector) {
        var P = $('div.post-container'),a,n,t,l,i,c;
        a = P.find('h1,h2,h3,h4,h5,h6');
        a.each(function () {
            n = $(this).prop('tagName').toLowerCase();
            i = "#"+$(this).prop('id');
            t = $(this).text();
            c = $('<a href="'+i+'" rel="nofollow">'+t+'</a>');
            l = $('<li class="'+n+'_nav"></li>').append(c);
            $(selector).append(l);
        });
        return true;    
    }

    generateCatalog(".catalog-body");

    // toggle side catalog
    $(".catalog-toggle").click((function(e){
        e.preventDefault();
        $('.side-catalog').toggleClass("fold")
    }))

    /*
     * Doc: https://github.com/davist11/jQuery-One-Page-Nav
     * Fork by Hux to support padding
     */
    async("/js/jquery.nav.js", function () {
        $('.catalog-body').onePageNav({
            currentClass: "active",
            changeHash: !1,
            easing: "swing",
            filter: "",
            scrollSpeed: 700,
            scrollOffset: 0,
            scrollThreshold: .2,
            begin: null,
            end: null,
            scrollChange: null,
            padding: 80
        });
    });
</script>





<!-- Image to hack wechat -->
<img src="/img/apple-touch-icon.png" width="0" height="0" />
<!-- Migrate from head to bottom, no longer block render and still work -->

</body>

</html>
